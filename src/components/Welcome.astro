---
import {Image} from "astro:assets";
import jsHeadshot from "../assets/js-headshot.png";
import resumePdf from "../assets/jeffscotti_resume.pdf";
import resumeDocx from "../assets/jeffscotti_resume.docx?url";
---

<div class="welcome-container">
  <main class="main-content">
    <div class="home-content">
      <div class="single-column-layout">
        <div class="text-column">
          <span class="name">Hello! I'm Jeff.</span>
          <h1 class="intro-text section-title">
            I build blazing‑fast web apps where <span class="highlight">thoughtful design</span> meets clean, scalable code.
          </h1>
          <p class="bio">
            For 15 years I’ve paired UX strategy with frontend engineering to ship interfaces that look sharp and run even sharper. Grounded in user research, my work turns complex flows into friction‑free journeys that keep people engaged.
          </p>
          <div class="button-container">
            <div class="dropdown">
              <button class="btn dropdown-toggle">
                <span class="circle-effect"></span>
                <span>Download Resume</span>
                <i class="fa-solid fa-chevron-down"></i>
              </button>
              <div class="dropdown-menu">
                <div class="mobile-menu-header">
                  <h3>Resume Options</h3>
                  <button class="mobile-close-btn">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
                <a
                  href={resumePdf}
                  class="dropdown-item"
                  target="_blank"
                  aria-label="Download PDF version of Jeff Scotti's resume">
                  <i class="fa-solid fa-file-pdf"></i>
                  <span>PDF Version</span>
                </a>
                <a
                  href={resumeDocx}
                  class="dropdown-item"
                  target="_blank"
                  aria-label="Download Word version of Jeff Scotti's resume">
                  <i class="fa-solid fa-file-word"></i>
                  <span>Word Version</span>
                </a>
              </div>
            </div>
          
            <a href="/projects" class="btn magnetic-button" aria-label="Navigate to Jeff Scotti's contact page">
             <span class="circle-effect"></span>
              See My Work
              <i class="fa-solid fa-arrow-right"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<style>
  .welcome-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    padding: 1.5rem 0 5rem 0;
  }

  .testimonials-section {
    padding: 60px 0;
    width: 100%;
  }

  .main-content {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  .home-content {
    width: 100%;
    max-width: 1200px;
  }

  .single-column-layout {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    width: 100%;
  }

  .text-column {
    width: 100%;
    padding: 40px 10px;
    text-align: left;
  }

  .home-photo {
    display: block;
    position: relative;
    width: 262px;
    height: 262px;
    border-radius: 50%;
    overflow: hidden;
    background-color: var(--border-color);
    border: 5px solid var(--border-color);
  }

  .headshot-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .job-title {
    font-size: 20px;
    font-weight: 400;
  }

  .job-title-line {
    display: inline-block;
  }

  .name {
    display: block;
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 15px;
    font-weight: 500;
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.2s forwards;
  }

  .intro-text {
    font-size: 50px;
    line-height: 56px;
    margin-top: 15px;
    margin-bottom: 25px;
    font-weight: 300;
    color: var(--heading-color);
  }

  .highlight {
    color: var(--primary-color);
    position: relative;
    font-weight: 500;
  }

  .highlight::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-color), transparent);
    opacity: 0.3;
  }

  .bio {
    font-size: 18px;
    margin-bottom: 30px;
    line-height: 1.75;
    color: var(--text-color);
    visibility: visible;
    opacity: 1;
    contain: none;
    will-change: auto; 
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .button-container {
    width: 100%;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
  }

  .dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
  }

  .dropdown-toggle .circle-effect {
    position: absolute;
    width: 0;
    height: 0;
    border-radius: 50%;
    background-color: var(--button-hover-bg-color);
    transition: width 0.4s ease-in-out, height 0.4s ease-in-out;
    transform: translate(-50%, -50%);
    z-index: -1;
  }

  .dropdown-toggle:hover {
    color: var(--button-hover-text-color);
  }

  .dropdown-toggle:hover .circle-effect {
    width: 225%;
    height: 562.5px;
  }

  .dropdown-toggle:hover {
    color: var(--button-hover-text-color);
    border-color: var(--button-hover-bg-color);
  }

  .dropdown-toggle:active {
    color: var(--button-hover-text-color);
    background-color: var(--button-hover-bg-color);
    border-color: var(--button-hover-bg-color);
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: calc(100% + 8px);
    left: 2px;
    width: 95%;
    background-color: var(--button-bg-color);
    border: 0.125rem solid var(--button-border-color);
    border-radius: 0.9375rem;
    padding: 0;
    z-index: 1000;
    color: var(--button-text-color);
  }

  .mobile-menu-header {
    display: none;
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    justify-content: space-between;
    align-items: center;
  }

  .mobile-menu-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 500;
  }

  .mobile-close-btn {
    background: none;
    border: none;
    color: var(--heading-color);
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
  }

  .mobile-close-btn:hover {
    color: var(--primary-color);
  }

  /* Bridge element to maintain hover */
  .dropdown::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: 8px; /* Same as gap to dropdown menu */
  }

  .dropdown:hover .dropdown-menu {
    display: block;
  }

  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    color: var(--button-text-color);
    text-decoration: none;
    transition: all 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    font-size: 15px;
  }

  .dropdown-menu .dropdown-item:hover {
    background-color: var(--button-hover-bg-color);
    color: var(--button-hover-text-color);
  }

  .dropdown-menu .dropdown-item:first-of-type:hover {
    border-top-left-radius: 0.9375rem;
    border-top-right-radius: 0.9375rem;
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 0;
  }

  .dropdown-menu .dropdown-item:last-child:hover {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0.9375rem;
    border-bottom-left-radius: 0.9375rem;
  }

  /* Media query for tablets */
  @media screen and (max-width: 992px) {
    .name {
      font-size: 48px;
      line-height: 56px;
    }
    
    .bio {
      font-size: 17px;
    }
  }

  /* Media query for mobile devices */
  @media screen and (max-width: 768px) {
    .two-column-layout {
      flex-direction: column;
    }

    .image-column,
    .text-column {
      flex: 0 0 100%;
      max-width: 100%;
    }

    .welcome-container {
      padding: 5rem 0 2.5rem 0;
    }

    /* Optimize image size for mobile */
    .home-photo {
      width: 200px;
      height: 200px;
    }

    .home-buttons {
      justify-content: center;
    }

    .btn {
      width: 100%;
      display: block;
      margin-right: 0;
      margin-bottom: 10px;
    }

    .bio {
      padding-right: 0;
      font-size: 16px;
      line-height: 1.6;
    }

    .name {
      font-size: 17px;
      text-align: center;
      width: 100%;
    }

    .intro-text {
      font-size: 36px;
      line-height: 44px;
      margin-bottom: 10px;
      text-align: center;
      width: 100%;
    }
    
    .job-title {
      text-align: center;
      width: 100%;
      font-size: 18px;
    }

    .job-title-line {
      display: block;
      text-align: center;
      width: 100%;
    }

    .dropdown {
      width: 100%;
    }

    .dropdown-toggle {
      justify-content: center;
      text-align: center;
    }

    .dropdown-toggle .fa-chevron-down {
      display: none;
    }

    .dropdown-menu {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background-color: var(--background-color);
      backdrop-filter: blur(5px);
      z-index: 2000;
      padding: 0;
      border-radius: 0;
      transform: translateX(100%);
      transition: transform 0.2s ease-in-out;
      flex-direction: column;
      overflow-y: auto;
    }

    .dropdown-menu.active {
      display: flex;
      transform: translateX(0);
    }

    .dropdown-menu.closing {
      transform: translateX(100%);
    }

    .mobile-menu-header {
      display: flex;
      position: sticky;
      top: 0;
      background-color: var(--container-bg-color);
      color: var(--heading-color);
      z-index: 10;
    }

    .dropdown-item {
      padding: 16px;
      font-size: 18px;
      color: var(--text-color);
    }

    .dropdown-item:hover {
      background-color: var(--button-hover-bg-color);
      color: var(--button-hover-text-color);
    }

    /* Override hover behavior on mobile */
    .dropdown:hover .dropdown-menu {
      display: none;
    }

    .dropdown::after {
      display: none;
    }

    .main-content {
      padding: 0;
    }
  }
  
  /* Media query for very small screens */
  @media screen and (max-width: 480px) {
    .intro-text {
      font-size: 28px;
      line-height: 36px;
    }
    
    .bio {
      font-size: 15px;
      line-height: 1.5;
    }
    
    .name {
      font-size: 16px;
    }
    
    .text-column {
      padding: 0;
    }
  }
</style>

<script>
  import anime from "animejs";

  // Function to handle animations after critical content is loaded
  const initAnimations = () => {
    // Use requestIdleCallback or setTimeout to defer non-critical animations
    const runAnimations = () => {
      anime({
        targets: ".name .char",
        translateY: [-80, 0],
        opacity: [0, 1],
        easing: "easeOutCubic",
        duration: 1000,
        delay: anime.stagger(100),
      });
    };

    // Use requestIdleCallback if available, otherwise setTimeout
    if ("requestIdleCallback" in window) {
      // @ts-ignore - TypeScript might not recognize requestIdleCallback
      window.requestIdleCallback(runAnimations);
    } else {
      setTimeout(runAnimations, 100);
    }
  };

  // Prioritize bio paragraph rendering
  const prioritizeBio = () => {
    const bioElement = document.querySelector('.bio[data-priority="high"]') as HTMLElement;
    if (bioElement) {
      // Force the browser to prioritize this element
      bioElement.style.visibility = "visible";
      bioElement.style.opacity = "1";
    }
  };

  // Execute immediately
  prioritizeBio();

  document.addEventListener("DOMContentLoaded", () => {
    // Ensure bio is prioritized
    prioritizeBio();

    // Defer animations to improve LCP
    if (document.readyState === "complete") {
      initAnimations();
    } else {
      window.addEventListener("load", initAnimations);
    }

    // Handle circle effect for dropdown toggle
    const dropdownToggle = document.querySelector(".dropdown-toggle") as HTMLButtonElement | null;
    const circleEffect = document.querySelector(".circle-effect") as HTMLSpanElement | null;
    
    if (dropdownToggle && circleEffect) {
      dropdownToggle.addEventListener("mouseenter", (e) => {
        const rect = dropdownToggle.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        circleEffect.style.left = `${x}px`;
        circleEffect.style.top = `${y}px`;
      });
    }

    // Mobile menu functionality
    const isMobile = (): boolean => window.innerWidth <= 768;
    const dropdownMenu = document.querySelector(".dropdown-menu") as HTMLDivElement | null;
    const closeButton = document.querySelector(".mobile-close-btn") as HTMLButtonElement | null;
    const menuItems = document.querySelectorAll(".dropdown-item");
    const MENU_ANIMATION_DURATION = 200;

    const openMobileMenu = (e: Event): void => {
      if (isMobile() && dropdownMenu) {
        e.preventDefault();
        e.stopPropagation();
        dropdownMenu.style.display = "flex";
        // Force reflow
        void (dropdownMenu as HTMLElement).offsetWidth;
        dropdownMenu.classList.add("active");
        document.body.style.overflow = "hidden";
      }
    };

    const closeMobileMenu = (e: Event): void => {
      if (isMobile() && dropdownMenu && dropdownMenu.classList.contains("active")) {
        e.preventDefault();
        e.stopPropagation();
        dropdownMenu.classList.add("closing");
        dropdownMenu.classList.remove("active");

        setTimeout(() => {
          if (dropdownMenu) {
            dropdownMenu.classList.remove("closing");
            dropdownMenu.style.display = "none";
            document.body.style.overflow = "";
          }
        }, MENU_ANIMATION_DURATION);
      }
    };

    if (dropdownToggle && dropdownMenu && closeButton) {
      // Only add click event for mobile menu on mobile
      dropdownToggle.addEventListener("click", (e) => {
        if (isMobile()) {
          openMobileMenu(e);
        }
      });
      closeButton.addEventListener("click", closeMobileMenu);

      menuItems.forEach((item) => {
        item.addEventListener("click", () => {
          if (isMobile() && dropdownMenu && dropdownMenu.classList.contains("active")) {
            dropdownMenu.classList.add("closing");
            dropdownMenu.classList.remove("active");
            setTimeout(() => {
              if (dropdownMenu) {
                dropdownMenu.classList.remove("closing");
                dropdownMenu.style.display = "none";
                document.body.style.overflow = "";
              }
            }, MENU_ANIMATION_DURATION);
          }
        });
      });

      window.addEventListener("resize", () => {
        if (!isMobile() && dropdownMenu && dropdownMenu.classList.contains("active")) {
          dropdownMenu.classList.remove("active", "closing");
          dropdownMenu.style.display = "";
          document.body.style.overflow = "";
        }
      });
    }
  });
</script>

<div
  id="vanta-bg"
  style="width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; z-index: -1;"
  data-vanta-background>
</div>
<script is:inline src="/js/three.min.js"></script>
<script is:inline src="/js/vanta.dots.min.js"></script>
<script is:inline>
  // Store the effect globally to prevent recreation during transitions
  let vantaEffect = null;

  function initVantaEffect() {
    const element = document.getElementById("vanta-bg");
    if (!element) {
      console.error("Background element not found");
      return;
    }

    const isLightTheme = document.documentElement.classList.contains("theme-light");

    // Reduce complexity on mobile
    const isMobile = window.innerWidth < 768;
    const spacing = isMobile ? 45.0 : 35.0;
    const scale = isMobile ? 0.8 : 1.0;

    // Destroy existing effect if it exists
    if (vantaEffect && typeof vantaEffect.destroy === "function") {
      vantaEffect.destroy();
      vantaEffect = null;
    }

    // Initialize with appropriate theme colors
    vantaEffect = VANTA.DOTS({
      el: element,
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.0,
      minWidth: 200.0,
      scale: scale,
      scaleMobile: scale,
      color: isLightTheme ? 0x333333 : 0xd5d5d5,
      backgroundColor: isLightTheme ? 0xf5f5f5 : 0x222222,
      size: 1.0,
      spacing: spacing,
      showLines: false,
    });
  }

  document.addEventListener("DOMContentLoaded", initVantaEffect);

  // Re-initialize after page transitions
  document.addEventListener("astro:page-load", initVantaEffect);

  document.addEventListener("themeChanged", (e) => {
    initVantaEffect();
  });
</script>

---
import TestimonialItem from './TestimonialItem.astro';
import { testimonials } from '../data/testimonials';

interface Props {
  title?: string;
  subtitle?: string;
  customTestimonials?: typeof testimonials;
}

const { 
  title = "Testimonials", 
  customTestimonials
} = Astro.props;

// Use custom testimonials if provided, otherwise use the default ones
// Filter out testimonials where visible is false
const testimonialsToShow = (customTestimonials || testimonials).filter(testimonial => 
  testimonial.visible !== false // Show testimonials where visible is true or undefined
);
---

<!-- Import Owl Carousel CSS from CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

<div class="testimonials-container">
  <div class="block-title">
    <h2>{title}</h2>
  </div>

  <div id="testimonials_1" class="testimonials owl-carousel owl-theme" data-mobile-items="1" data-tablet-items="2" data-items="2">
    {testimonialsToShow.map(testimonial => (
      <TestimonialItem testimonial={testimonial} />
    ))}
  </div>
</div>

<!-- Import jQuery and Owl Carousel JS from CDN -->
<script is:inline src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

<script>
  // Add type declaration for jQuery
  declare const jQuery: any;

  // Wait for both jQuery and Owl Carousel to be loaded
  window.addEventListener('load', () => {
    if (typeof jQuery !== 'undefined') {
      jQuery(document).ready(() => {
        // Initialize Owl Carousel
        jQuery("#testimonials_1").owlCarousel({
          nav: false, // Hide next/prev buttons
          items: 2, // The number of items you want to see on the screen
          loop: true, // Infinity loop
          navText: false,
          margin: 25,
          responsive : {
            // breakpoint from 0 up
            0 : {
              items: 1,
            },
            // breakpoint from 480 up
            480 : {
              items: 1,
            },
            // breakpoint from 768 up
            768 : {
              items: 2,
            },
            1200 : {
              items: 2,
            }
          }
        });
      });
    }
  });
</script>

<style is:global>
  /* Container for testimonials to match Welcome component margins */
  .testimonials-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  /* Testimonials Slider */
  .testimonial-item {
    padding: 30px;
    margin-bottom: 10px;
  }

  .testimonial-content {
    position: relative;
    padding: 30px 20px 20px 60px;
    background-color: var(--container-bg-color);
    border-radius: var(--border-radius-md);
    border: 2px solid var(--border-color);
    -webkit-transition: all .25s ease-in-out;
    -moz-transition: all .25s ease-in-out;
    -o-transition: all .25s ease-in-out;
    -ms-transition: all .25s ease-in-out;
    transition: all .25s ease-in-out;
  }

  .testimonial-picture {
    position: absolute;
    display: block;
    top: -30px;
    left: -30px;
    width: 80px;
    height: 80px;
  }

  .testimonial-picture img {
    display: inline-block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid var(--border-color);
  }

  .testimonial-text p {
    font-style: italic;
    color: var(--text-color);
  }

  .testimonial-author-info {
    margin-top: 15px;
  }

  .testimonial-author {
    margin: 0 0 2px;
    font-size: 0.9em;
    color: var(--heading-color);
  }

  .testimonial-firm {
    margin: 0;
    font-size: 0.8em;
    color: var(--text-color);
    opacity: 0.8;
  }

  .testimonial-icon {
    display: block;
    line-height: 20px;
    font-size: 20px;
    position: absolute;
    left: 20px;
    bottom: 46px;
    color: var(--border-color);
  }

  .testimonial-icon-big {
    bottom: -24px;
    color: var(--border-color);
    opacity: 0.2;
    z-index: -1;
  }

  /* Owl Carousel Navigation */
  .testimonials.owl-carousel .owl-dots {
    position: relative;
    width: 100%;
    text-align: center;
  }

  .testimonials.owl-carousel .owl-dot {
    display: inline-block;
    margin: 3px 0;
  }

  .testimonials.owl-carousel .owl-dot span {
    display: block;
    height: 3px;
    background-color: var(--border-color);
    border-radius: 3px;
    margin: 4px;
    width: 20px;
    -webkit-transition: all .25s ease-in-out;
    -moz-transition: all .25s ease-in-out;
    -o-transition: al